<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yuna Select v29</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #e63946; --bg: #fffafb; --card-bg: #ffffff; --text-main: #2b2d42; --text-sub: #8d99ae; }
        body { font-family: -apple-system, "PingFang TC", sans-serif; background: var(--bg); margin: 0; color: var(--text-main); }
        
        /* å€å¡Šéš±è—æ§åˆ¶ */
        .sub-page { display: none; padding: 20px; min-height: 100vh; }
        .sub-page.active { display: block; }

        /* æ¨™é¡Œ */
        .main-header { text-align: center; padding: 60px 0 30px; }
        .main-header h1 { margin: 0; font-size: 32px; color: var(--primary); letter-spacing: 3px; font-weight: 900; }

        /* é¦–é é¸å–® */
        #homePage { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .main-btn { 
            aspect-ratio: 1/1; border-radius: 30px; border: none; font-size: 18px; font-weight: bold; color: white; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05); transition: 0.2s;
        }
        .btn-add { background: #e63946; grid-column: span 2; aspect-ratio: auto; height: 120px; font-size: 22px; }
        .btn-list { background: #457b9d; }
        .btn-pre { background: #2a9d8f; }
        .btn-cust { background: #2b2d42; grid-column: span 2; aspect-ratio: auto; height: 80px; }

        /* é ‚éƒ¨å°è¦½åˆ— */
        .header-bar { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .back-btn { background: white; border: 1px solid #eee; padding: 8px 20px; border-radius: 50px; font-weight: bold; }

        /* è¼¸å…¥æ¡†é¢¨æ ¼ (æ‚¨è¦çš„å¤§åœ“è§’) */
        .card { background: var(--card-bg); padding: 25px; border-radius: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
        .form-group { margin-bottom: 18px; }
        label { display: block; font-size: 14px; font-weight: bold; margin-bottom: 8px; margin-left: 15px; color: var(--text-sub); }
        input { 
            width: 100%; padding: 15px 25px; border: 1px solid #f2f2f2; border-radius: 50px; 
            box-sizing: border-box; font-size: 16px; background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        }
        input:focus { outline: none; border-color: var(--primary); }

        /* æŒ‰éˆ•é¢¨æ ¼ */
        .submit-btn { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 50px; font-size: 18px; font-weight: bold; margin-top: 10px; }
        .btn-group { display: flex; gap: 10px; }
        .btn-opt { flex: 1; padding: 12px; border: 1px solid #eee; border-radius: 50px; background: white; font-weight: bold; }
        .btn-opt.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* åˆ—è¡¨æ¨£å¼ */
        .item-row { background: white; padding: 15px; border-radius: 25px; margin-bottom: 12px; display: flex; gap: 15px; align-items: center; }
        .item-img { width: 70px; height: 70px; object-fit: cover; border-radius: 15px; }
    </style>
</head>
<body>

    <div id="homePage">
        <div class="main-header" style="grid-column: span 2;"><h1>Yuna Select</h1></div>
        <button class="main-btn btn-add" onclick="showPage('part1')"><span>ï¼‹ æ–°å¢ç¾å ´æ¡è³¼</span></button>
        <button class="main-btn btn-list" onclick="showPage('part2')">ğŸ“‹ æ¡è³¼æ˜ç´°</button>
        <button class="main-btn btn-pre" onclick="showPage('part4')">ğŸ“ é è³¼å•†å“</button>
        <button class="main-btn btn-cust" onclick="showPage('part3')">ğŸ‘¥ çµ±è¨ˆå°å¸³</button>
    </div>

    <div id="part1" class="sub-page">
        <div class="header-bar"><button class="back-btn" onclick="showPage('home')">â† è¿”å›</button><h2>æ–°å¢æ¡è³¼</h2></div>
        <div class="card">
            <div class="form-group"><label>ğŸ“· å•†å“ç…§ç‰‡</label><input type="file" id="pImg" accept="image/*"></div>
            <div class="form-group"><label>ğŸ“¦ å•†å“åç¨±</label><input type="text" id="pName" placeholder="è«‹è¼¸å…¥åç¨±"></div>
            <div class="form-group"><label>ğŸ’° è²©å”®åƒ¹æ ¼</label><input type="number" id="pPriceSell" placeholder="0"></div>
            <div class="form-group"><label>ğŸ‘¤ é¡§å®¢å§“å</label><input type="text" id="pCustomer" placeholder="å®¢äººæš±ç¨±"></div>
            <div class="form-group">
                <label>ğŸ§¤ è² è²¬è²·æ‰‹</label>
                <div class="btn-group">
                    <button class="btn-opt" onclick="setBuyer('Ray', this)">Ray</button>
                    <button class="btn-opt" onclick="setBuyer('Nana', this)">Nana</button>
                    <button class="btn-opt" onclick="setBuyer('Cupid', this)">Cupid</button>
                </div>
                <input type="hidden" id="pBuyer">
            </div>
            <button class="submit-btn" onclick="saveData()">ç¢ºèªå„²å­˜</button>
        </div>
    </div>

    <div id="part2" class="sub-page">
        <div class="header-bar"><button class="back-btn" onclick="showPage('home')">â† è¿”å›</button><h2>æ¡è³¼æ˜ç´°</h2></div>
        <div id="allList"></div>
    </div>

    <div id="part3" class="sub-page">
        <div class="header-bar"><button class="back-btn" onclick="showPage('home')">â† è¿”å›</button><h2>å°å¸³çµ±è¨ˆ</h2></div>
        <button onclick="exportToExcel()" class="submit-btn" style="background:#2b2d42; margin-bottom: 20px;">ğŸ“Š åŒ¯å‡º Excel</button>
        <div id="customerList"></div>
    </div>

    <div id="part4" class="sub-page">
        <div class="header-bar"><button class="back-btn" onclick="showPage('home')">â† è¿”å›</button><h2>é è³¼æ¸…å–®</h2></div>
        <div class="card">
            <input type="text" id="preName" placeholder="å•†å“åç¨±" style="margin-bottom:10px;">
            <input type="text" id="preCust" placeholder="é¡§å®¢å§“å" style="margin-bottom:10px;">
            <button class="submit-btn" style="background:#2a9d8f;" onclick="savePreOrder()">å„²å­˜é è³¼</button>
        </div>
        <div id="preOrderList"></div>
    </div>

    <script>
        // Firebase è¨­å®šä¿æŒä¸è®Š
        const firebaseConfig = {
            apiKey: "AIzaSyBxy3g2MS18oJdE2v-JAZ9VWXZwZQ9W4yM",
            databaseURL: "https://yunabuy-cf20c-default-rtdb.firebaseio.com/",
            projectId: "yunabuy-cf20c",
            appId: "1:994921038504:web:6b1c54b9a71ee425b3f89d"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const dataRef = db.ref('yuna_v26_data'); 
        const preRef = db.ref('yuna_v26_preorder');

        function showPage(pageId) {
            // éš±è—æ‰€æœ‰é é¢
            document.getElementById('homePage').style.display = 'none';
            document.querySelectorAll('.sub-page').forEach(p => p.classList.remove('active'));
            
            // é¡¯ç¤ºç›®æ¨™é é¢
            if(pageId === 'home') {
                document.getElementById('homePage').style.display = 'grid';
            } else {
                document.getElementById(pageId).classList.add('active');
            }
            window.scrollTo(0,0);
        }

        function setBuyer(name, btn) {
            document.getElementById('pBuyer').value = name;
            document.querySelectorAll('.btn-opt').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        async function saveData() {
            const file = document.getElementById('pImg').files[0];
            let base64 = "";
            if(file) base64 = await new Promise(res => { const reader = new FileReader(); reader.onload = e => res(e.target.result); reader.readAsDataURL(file); });
            dataRef.push({
                name: document.getElementById('pName').value || "æœªå‘½å",
                priceSell: document.getElementById('pPriceSell').value || "0",
                customer: document.getElementById('pCustomer').value || "æœªå¡«",
                buyer: document.getElementById('pBuyer').value || "æœªé¸",
                img: base64, time: new Date().toLocaleString()
            }).then(() => {
                alert('å„²å­˜æˆåŠŸï¼');
                showPage('home');
            });
        }

        // è³‡æ–™ç›£è½èˆ‡æ¸²æŸ“é‚è¼¯ (ç°¡åŒ–ç‰ˆ)
        dataRef.on('value', snap => {
            const items = snap.val() || {};
            const html = Object.entries(items).reverse().map(([id, i]) => `
                <div class="item-row">
                    <img src="${i.img || ''}" class="item-img">
                    <div style="flex:1">
                        <div style="font-weight:bold">${i.name}</div>
                        <div style="color:var(--primary); font-weight:bold;">Â¥ ${i.priceSell}</div>
                        <div style="font-size:12px; color:#888;">ğŸ‘¤ ${i.customer} | ğŸ§¤ ${i.buyer}</div>
                    </div>
                </div>
            `).join('');
            document.getElementById('allList').innerHTML = html;
        });
    </script>
</body>
</html>
